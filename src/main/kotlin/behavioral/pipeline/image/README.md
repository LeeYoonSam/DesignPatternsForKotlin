# Pipeline Pattern

## 설명
Pipeline 패턴은 데이터를 일련의 처리 단계를 통해 순차적으로 변환하는 행위(Behavioral) 디자인 패턴입니다. 각 단계는 입력을 받아 처리하고 그 결과를 다음 단계로 전달합니다. Unix의 파이프 개념에서 영감을 받은 이 패턴은 복잡한 처리 로직을 작고 재사용 가능한 단계로 분해할 수 있게 해줍니다.

## 문제점
1. 코드 집중화
    - 모든 처리 로직이 하나의 클래스에 집중
    - 메서드 파라미터가 과도하게 많아짐
    - 조건문이 복잡하게 중첩됨
2. 유연성 부족
    - 처리 단계의 추가/제거가 어려움
    - 처리 순서 변경이 어려움
    - 조건부 처리 구현이 복잡함
3. 재사용성 부족
    - 개별 처리 로직의 재사용 불가능
    - 코드 중복 발생
    - 테스트하기 어려움
4. 단일 책임 원칙(SRP) 위반
    - 하나의 클래스가 여러 책임을 가짐
    - 변경 시 영향 범위가 넓음

## Pipeline 패턴의 주요 장점
1. 관심사 분리
    - 각 처리 단계가 독립적인 클래스로 분리
    - 단일 책임 원칙 준수
    - 코드 가독성 향상
2. 유연한 조합
    - 처리 단계의 자유로운 조합
    - 런타임에 파이프라인 구성 가능
    - 조건부 단계 추가 용이
3. 재사용성
    - 개별 단계의 다양한 파이프라인에서 재사용
    - 미리 정의된 파이프라인 템플릿 제공
    - 코드 중복 감소
4. 테스트 용이성
    - 각 단계를 독립적으로 테스트 가능
    - 모킹과 스터빙이 쉬움
    - 단위 테스트와 통합 테스트 분리

## 주요 구성 요소
1. Stage (단계)
    - 단일 처리 작업을 수행하는 인터페이스
    - 입력을 받아 출력을 반환
    - 함수형 인터페이스로 구현 가능
2. Pipeline (파이프라인)
    - 여러 단계를 순차적으로 연결
    - 입력 데이터를 모든 단계를 통해 처리
    - fold 연산을 통한 체이닝
3. Pipeline Builder (빌더)
    - 파이프라인 구성을 위한 빌더
    - 조건부 단계 추가 지원
    - 플루언트 인터페이스 제공
4. Pipeline Factory (팩토리)
    - 미리 정의된 파이프라인 템플릿
    - 자주 사용되는 파이프라인 조합 제공

## Chain of Responsibility 패턴과의 차이점
| 특성 | Pipeline 패턴 | Chain of Responsibility 패턴 |
|------|--------------|------------------------------|
| 목적 | 데이터 변환/처리 | 요청 처리 책임 위임 |
| 데이터 흐름 | 모든 단계를 순차적으로 통과 | 적절한 핸들러를 찾으면 중단 |
| 반환값 | 변환된 데이터 반환 | 처리 성공/실패 여부 |
| 단계 간 관계 | 모든 단계가 처리에 참여 | 하나의 핸들러만 처리 |

## 실제 활용 사례
1. 이미지 처리
    - 리사이즈 -> 필터 적용 -> 워터마크 -> 압축
    - 포맷 변환 파이프라인
    - 배치 이미지 처리
2. 데이터 ETL
    - Extract -> Transform -> Load
    - 데이터 정제 파이프라인
    - 데이터 마이그레이션
3. 컴파일러
    - Lexing -> Parsing -> Semantic Analysis -> Code Generation
    - 최적화 단계 체인
4. HTTP 요청/응답 처리
    - 요청 파싱 -> 인증 -> 검증 -> 처리 -> 응답 포맷팅
    - 미들웨어 체인
5. 빌드 시스템
    - 소스 컴파일 -> 테스트 -> 패키징 -> 배포
    - CI/CD 파이프라인
6. 텍스트 처리
    - 토큰화 -> 정규화 -> 필터링 -> 분석
    - NLP 전처리 파이프라인

## Kotlin에서의 구현 특징
1. 함수형 인터페이스 (SAM)
    - `fun interface`로 람다 표현식 지원
    - 간결한 단계 정의 가능
2. fold 연산
    - 컬렉션의 fold를 활용한 체이닝
    - 함수형 프로그래밍 스타일
3. 확장 함수
    - 파이프라인에 확장 함수 추가 가능
    - DSL 스타일 구성

## 주의사항
1. 단계 순서
    - 단계 실행 순서가 결과에 영향
    - 의존성 있는 단계의 순서 주의
2. 에러 처리
    - 중간 단계 실패 시 전체 파이프라인 중단
    - 롤백 메커니즘 필요 시 고려
3. 성능
    - 많은 단계 시 오버헤드 발생 가능
    - 불필요한 객체 생성 최소화
4. 타입 안전성
    - 제네릭을 활용한 타입 안전성 확보
    - 단계 간 타입 불일치 방지

## 결론
Pipeline 패턴은 복잡한 데이터 처리 로직을 작고 관리 가능한 단계로 분해하는 강력한 패턴입니다. Kotlin의 함수형 프로그래밍 기능과 결합하면 더욱 간결하고 표현력 있는 코드를 작성할 수 있습니다. 특히 이미지 처리, ETL, 빌드 시스템 등 순차적인 데이터 변환이 필요한 모든 곳에서 유용하게 활용할 수 있습니다.
